---
lab:
  title: Изучение автоматизированных Машинное обучение в Машинное обучение Azure
---

# Изучение автоматизированных Машинное обучение в Машинное обучение Azure

В этом упражнении вы будете использовать функцию автоматического машинного обучения в Машинном обучении Azure для обучения и оценки модели машинного обучения. Затем вы развернете и протестируете обученную модель.

Это упражнение должно занять около **35** минут.

## Создание рабочей области машинного обучения Azure

Чтобы использовать Машинное обучение Azure, необходимо подготовить рабочую область Машинного обучения Azure в подписке Azure. Затем вы сможете использовать Студию машинного обучения Azure для работы с ресурсами в вашей рабочей области.

> **Совет**: Если у вас уже есть рабочая область Машинного обучения Azure, вы можете использовать ее и перейти к следующему заданию.

1. Войдите на [портал Azure](https://portal.azure.com) на `https://portal.azure.com` с помощью вашей учетной записи Майкрософт.

1. Выберите **＋Создать ресурс**, выполните поиск по критерию *Машинное обучение* и создайте новый ресурс **Машинное обучение Azure** со следующими параметрами:
    - **Подписка**: *ваша подписка Azure*.
    - **Группа ресурсов**: *создайте или выберите группу ресурсов*.
    - **Имя**: *Введите уникальное имя для рабочей области*.
    - **Регион**: Восточная часть США.
    - **Учетная запись хранения**: *обратите внимание на новую учетную запись хранения по умолчанию, которая будет создана для рабочей области*.
    - **Хранилище ключей**: *обратите внимание на новое хранилище ключей по умолчанию, которое будет создано для рабочей области*.
    - **Application Insights**: *обратите внимание на новый ресурс Application Insights по умолчанию, который будет создан для рабочей области*.
    - **Реестр контейнеров**: нет (*один будет создан автоматически при первом развертывании модели в контейнере*).

1. Выберите **Проверить и создать**, а затем выберите **Создать**. Дождитесь создания рабочей области (это может занять несколько минут), а затем перейдите к развернутому ресурсу.

#### Запустить студию 

1. В ресурсе рабочей области Машинное обучение Azure выберите **"Запустить студию**" (или откройте новую вкладку браузера и перейдите к ней и войдите [https://ml.azure.com](https://ml.azure.com)в Студия машинного обучения Azure с помощью учетной записи Майкрософт). Закройте все отображаемые сообщения.

1. В Студии машинного обучения Azure вы увидите только что созданную рабочую область. Если нет, выберите **Все рабочие области** в меню слева и выберите только что созданную рабочую область.

## Используйте автоматизированное машинное обучение для обучения модели

Автоматизированное машинное обучение позволяет попробовать несколько алгоритмов и параметров для обучения нескольких моделей и определить наиболее подходящий для ваших данных. В этом упражнении вы воспользуетесь набором данных из сведений о прокате велосипедов за прошлые периоды, чтобы обучить модель, прогнозирующую ожидаемое число клиентов, берущих напрокат велосипед, в определенный день в зависимости от времени года и погодных условий.

> **Ссылка**: *Данные, используемые в этом упражнении получены от [Capital Bikeshare](https://www.capitalbikeshare.com/system-data) и используются в соответствии с [лицензионным соглашением ](https://www.capitalbikeshare.com/data-license-agreement) в отношении опубликованных данных*.

1. В [Студии Машинного обучения Azure](https://ml.azure.com?azure-portal=true) перейдите на страницу **Автоматизированное ML** (раздел **Разработка**).

1. Создайте новое задание автоматизированного машинного обучения со следующими параметрами, используя кнопку **Далее** по мере необходимости для продвижения по пользовательскому интерфейсу:

    **Основные параметры**:

    - **Имя задания: поле имени** задания уже должно быть предварительно заполнено уникальным именем. Оставьте эту настройку без изменений.
    - **Новое имя** эксперимента: `mslearn-bike-rental`
    - **Description** (Описание): `Automated machine learning for bike rental prediction`
    - **Теги**: *нет*

   **Тип задания и данные**:
    
    >**ПРИМЕЧАНИЕ**. Некоторые подписки имеют разрешения, которые не позволяют *добавлять данные* велосипеда в *workspaceblobstore*. Если вы столкнулись с этой проблемой, в настоящее время необходимо либо переключиться на личную подписку, либо настроить разрешения вашей подписки. 

    - **Выбор типа задания**: Регрессия
    - **Выберите данные**:
        - Создайте новый ресурс данных со следующими параметрами:
            - **Тип данных**:
                - **Имя**: `bike-rentals`
                - **Description** (Описание): `Historic bike rental data`
                - **Тип**: Таблица (mltable)
            - **Источник данных**:
                - Выбор **из локальных файлов**
            - **Тип** целевого хранилища:
                - **Тип** хранилища данных: Хранилище BLOB-объектов Azure
                - **Имя**: workspaceblobstore
            - **Выбор** MLtable:
                - *Скачайте и распакуйте папку [](https://aka.ms/bike-rentals) bike-data из`https://aka.ms/bike-rentals`.*
                - **** Папка отправки: *отправьте извлеченную **папку bike-data**, содержащую файлы определения данных и таблиц, необходимые для обучающего набора данных.*
                - **Примечание.*** Если вы столкнулись с сообщением о пропуске проверки данных для продолжения, выберите параметр пропуска проверки данных.*
        - Выберите только что созданный **ресурс данных проката велосипедов**** и продолжайте определять задание автоматизированного машинного обучения на следующей странице (** параметры задачи).

    **Настройки задания**:

    - **Тип задания**: Регрессия
    - **Набор данных**: bike-rentals
    - **Целевой столбец**: аренда (целое число)
    - **Дополнительные параметры конфигурации**:
        - **Основная метрика**: NormalizedRootMeanSquaredError
        - **Объяснить лучшую модель**: *<u>un</u>selected*
        - **Включение стека** ансамбля: *<u>un</u>selected*
        - **Использовать все поддерживаемые модели**: <u>не</u> выбрано. *Вы ограничите задание, чтобы опробовать только несколько конкретных алгоритмов.*
        - **Допустимые модели**: *выберите только **RandomForest** и **LightGBM**. Обычно следует испробовать как можно больше моделей, но каждая добавленная модель увеличивает время, затрачиваемое на выполнение задание.*
    - **Ограничения**. *Разверните этот раздел*
        - **Максимальное количество пробных версий**: `3`
        - **Максимальное число одновременных пробных версий**: `3`
        - **Максимальное** число узлов: `3`
        - **Пороговая** оценка метрик: `0.085` (*чтобы модель достигла нормализованной среднеквадратной среднеквадратической оценки ошибки 0,085 или меньше, задание заканчивается.*)
        - **Время ожидания** эксперимента: `15`
        - **Время ожидания** итерации: `15`
        - **Включение досрочного завершения**: *Выбрано*
    - **Проверка и тест**:
        - **Тип проверки**: Разделение обучение-проверка
        - **Процент данных проверки**: 10
        - **Тестовый набор данных**: Нет

    **Вычисления.**

    - **Выбор типа вычислений**: Бессерверный
    - **Тип виртуальной машины**: ЦП
    - **Уровень виртуальной машины**: Выделенный.
    - **Размер** виртуальной машины: Standard_DS3_V2\*
    - **Количество экземпляров**: 1

    \**Если подписка ограничивает доступные размеры виртуальных машин, выберите любой доступный размер.*

1. Отправьте задание обучения. Запускается автоматически.

1. Дождитесь остановки задания. Это может занять некоторое время, так что можете побаловать себя чашечкой кофе!

## Проверка наилучшей модели

После завершения задачи автоматизированного машинного обучения вы можете просмотреть лучшую модель, которую она обучила.

1. На вкладке **Обзор** задания автоматизированного машинного обучения изучите сводку по самой лучшей модели.
    ![Снимок экрана: сводка по самой лучшей модели задания автоматизированного машинного обучения, имя алгоритма выделено прямоугольником.](./media/use-automated-machine-learning/complete-run.png)
  
1. Выберите текст в разделе **Имя алгоритма** для лучшей модели, чтобы просмотреть сведения о ней.

1. Перейдите на вкладку **Метрики** и выберите диаграммы **residuals** и **predicted_true**, если они еще не выбраны.

    Изучите диаграммы, показывающие производительность модели. На диаграмме **остатков** отображаются *остатки* (различия между прогнозируемыми и фактическими значениями) в виде гистограммы. Диаграмма **predicted_true** сравнивает прогнозируемые значения с истинными значениями.

## Развертывание и тестирование модели

1. На вкладке **"Модель"** для оптимальной модели, обученной заданием автоматизированного машинного обучения, выберите " **Развернуть** " и используйте **параметр конечной точки** реального времени для развертывания модели со следующими параметрами:
    - **Виртуальная машина**: Standard_DS3_v2
    - **Число** экземпляров: 3
    - **Конечная точка**: новая
    - **Имя** конечной точки: *оставьте значение по умолчанию или убедитесь, что оно глобально уникально*
    - **Имя** развертывания: *оставьте значение по умолчанию*
    - **Сбор данных** вывода: *отключен*
    - **Модель** пакета: *отключена*

    > **Обратите внимание** , что при получении сообщения о нехватке квоты для выбора виртуальной машины *Standard_DS3_v2* выберите другую.

1. Подождите, пока начнется развертывание. Это может занять несколько секунд. Состояние **** развертывания конечной точки будет указано в главной части страницы в качестве *запуска*.
1. Дождитесь пока **Состояние развертывание** изменится на *Успешно*. Этот может занять 5-10 минут.

## Тестирование развернутой службы

Теперь можно протестировать развернутую службу.

1. В Студия машинного обучения Azure в меню слева выберите **конечные точки** и откройте созданную конечную точку в режиме реального времени.

1. На странице конечной точки в режиме реального времени перейдите на вкладку **"Тест** ".

1. В области **Входные данные для тестирования конечной точки** замените шаблон JSON указанными ниже входными данными:

    ```json
      {
     "input_data": {
       "columns": [
         "day",
         "mnth",
         "year",
         "season",
         "holiday",
         "weekday",
         "workingday",
         "weathersit",
         "temp",
         "atemp",
         "hum",
         "windspeed"
       ],
       "index": [0],
       "data": [[1,1,2022,2,0,1,1,2,0.3,0.3,0.3,0.3]]
     }
    }

    ```

1. Нажмите кнопку **Проверить**.

1. Проверьте результаты теста, которые включают прогнозируемое количество прокатов на основе входных функций — примерно так:

    ```JSON
    [
      352.3564674945718
    ]
    ```

    На панели тестирования были введены входные данные и использована модель, обученная для возврата прогнозируемого числа прокатов.

## Просмотр кода для использования службы

Теперь, когда у вас есть конечная точка прогнозной службы, разработчики могут создавать приложения, использующие его.

1. На странице конечной точки в режиме реального времени перейдите на вкладку **"Использование** ".
1. Просмотрите пример кода, чтобы использовать конечную точку, которая предоставляется для нескольких языков программирования.

Давайте посмотрим, что у вас получилось. Для обучения модели использовался набор данных об аренде велосипедов за прошедшие периоды. Модель прогнозирует ожидаемого количество велосипедов, взятых напрокат в течение определенного дня, на основе сезонных и метеорологических *признаков*. Наконец, вы проверили модель и проверили код, который разработчик может использовать для создания приложения для его использования.

## Очистка

Созданная веб-служба размещается в *экземпляре контейнера Azure*. Если вы не планируете экспериментировать с ним и дальше, следует удалить конечную точку, чтобы избежать лишнего использования ресурсов Azure.

1. На [вкладке **"Конечные точки" на вкладке Студия машинного обучения Azure "](https://ml.azure.com)Конечные точки"** выберите развернутую конечную точку. Затем щелкните **Удалить** и подтвердите удаление конечной точки.

    Удаление вычислений гарантирует, что в вашей подписке не будет начисляться плата за вычислительные ресурсы. Однако с вас будет взиматься небольшая плата за хранение данных, так как в вашей подписке существует рабочая область Машинного обучения Azure. Если вы завершили изучение возможностей Машинного обучения Azure, можно удалить рабочую область Машинного обучения Azure и связанные с ней ресурсы.

Чтобы удалить рабочую область:

1. На [портале Microsoft Azure](https://portal.azure.com) (страница **Группы ресурсов**) откройте группу ресурсов, указанную при создании рабочей области машинного обучения Azure.
2. Щелкните **Удалить группу ресурсов**, введите имя группы ресурсов, чтобы подтвердить ее удаление, и выберите **Удалить**.
